<!DOCTYPE html>
<html>

<head>
  <!-- title & favicon -->
  <title>Knoknok: For Roommates</title>
  <link rel="shortcut icon" href="/favicon.ico">
  <link rel="icon" href="/favicon.ico">
  <!-- fonts and formatting -->
  <link href='http://fonts.googleapis.com/css?family=Cabin|Telex' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" href="themes/KKstyle.css" />
  <link rel="stylesheet" href="http://code.jquery.com/mobile/1.4.2/jquery.mobile.structure-1.4.2.min.css" />
  <!-- mobile specific tags here -->
  <meta name="viewport" content="width=device-width; initial-scale=1.0; maximum-scale=1.0; user-scalable = 0;" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <!-- scripts galore -->
  <script src="http://code.jquery.com/jquery-1.10.2.min.js"></script>
  <script src="http://code.jquery.com/mobile/1.4.2/jquery.mobile-1.4.2.min.js"></script>
  <script src= "KKscript.js"></script>
</head>

<body>  
  <!-- the page for getting the key -->
  <div data-role= "page" data-theme = "a" id = "get2key">
      <div data-role="controlgroup" style = "width: 55%; margin: 0 auto">
            <h1>Welcome to Knoknok!</h1>
            <script>  
            var key = localStorage.getItem("userkey"); 
              //if(key > 100){
                var hostname = location.hostname;
                console.log(key)
                var newplace = "/?roomkey="+key+"#KKhome";
                console.log(hostname);
                console.log(newplace);
                console.log("newplace");
                window.location.assign(hostname + newplace);
             // }
            </script>
            <p>New User?</p>
            <br>
            <a href="#makeroom" class="ui-btn">Make a new Room</a>
            <p>Roomate sent you a key?</p>
            <br>
            <a href="#enterkey" class="ui-btn">Enter a Key</a>
      </div>
  </div>

  <!-- the page for entering a key -->
  <div data-role= "page" data-theme = "a" id = "enterkey">
      <form method="post" action="/#KKhome">
        <div class="ui-field-contain" style = "width: 55%; margin: 0 auto">
          <input type="tel" name="usernum" id="usernum" placeholder="Enter your phone number...">
          <input type="text" name="username" id="username" placeholder="Enter your name...">
          <input type="tel" name="roomkey" id="roomkey" placeholder="Enter key...">
        </div>
      </form>
      <a href="javascript:;" onclick="changeLink()" id="gobutton" class="ui-btn">Go to Knoknok!</a>
      <script>
        function changeLink() {
            var key = document.getElementById("roomkey").value;
            document.getElementById("gobutton").href = "/?roomkey=" + key + "#KKhome";
            console.log("__yes " + document.getElementById("gobutton").href + "__"); ////////////////////
            window.location.assign("/?roomkey=" + key + "#KKhome");
        }
      </script>
  </div>

  <!-- the page for entering initial info -->
  <div data-role= "page" data-theme = "a" id = "makeroom">
    <div class="ui-field-contain" style = "width: 55%; margin: 0 auto">
          <input type="tel" name="usernum" id="usernum" placeholder="Enter your phone number">
          <input type="text" name="enterroomname" id="enterroomname" placeholder="Enter the room's nickname">
          <input type="text" name="enterfirstname" id="enterfirstname" placeholder="Enter your first name">
    </div>
    <form action="/createroom" method="post">
        <a href="javascript:;" onclick="navig8();parentNode.submit();" class="ui-btn">Next...</a>
        <script>
          function navig8() {
              console.log("here1")
              window.location.assign("/#createroom");
              console.log("here2");
          }
        </script>
    </form>
  </div>

  <!-- the page for getting your key w/ option to send an sms -->
  <div data-role= "page" data-theme = "a" id = "createroom">
    <p>This is your room's key. It's what identifies your room! Give it to your roommate(s), and you'll never need it again.</p>
    <p id="key">Key : couldn't load key :(</p>
    <!-- SHITTY-ish script for getting random key -->
    <script>
      var str = "{{ roomkey }}"
      var firsthalf = str.slice(0,3)
      var secondhalf= str.slice(3,6)
      var wholekey = firsthalf + "-" + secondhalf 
      document.getElementById("key").innerHTML = "Key: " + wholekey
      localStorage.setItem("userkey", wholekey);
      console.log(":)))" + localStorage.getItem("userkey"));
    </script>
    <a href="#sendkey" class="ui-btn">Send this key</a>
    <a href="#KKhome" id="toreplace" class="ui-btn">Go to room</a>
    <script>
      var rkey = "{{ roomkey }}";
      document.getElementById("toreplace").href = "/?roomkey=" + rkey + "#KKhome";
    </script>
  </div>

  <!-- the page for generating a key the key to the roommate -->
  <div data-role= "page" data-theme = "a" id = "sendkey">
    <p id = "keytosend">Key:</p>
    <script>
      document.getElementById("keytosend").innerHTML = localStorage.getItem("userkey");
    </script>
    <form method="post" action="/sendsms" style ="width: 55%; margin: 0 auto">
      <div class="ui-field-contain">
        <input type="tel" name="sendnum" id="sendnum" placeholder="Roomate's Phone Number... ex. 8646336977">
        <input type="hidden" name="roomkey" value="key2" id="uniquekey3">
        <script>
          function setUKey3() {
              document.getElementById("uniquekey3").value = localStorage.getItem("userkey");
          }
        </script>
      </div>
      <a href="javascript:;" onclick="setUKey3();parentNode.submit();" class="ui-btn" style = "width: 55%; margin: 0 auto">Send this key</a>
    </form>
  </div>

  <!-- the main page, with status settings -->
  <div data-role= "page" data-theme = "a" id = "KKhome">
      <div data-role = "header" data-position = "inline">
        <h1 style = "width: 70%; margin: 0 auto;">KNOKNOK</h1>
       <!--  <a href="#" class="ui-btn ui-corner-all ui-icon-gear ui-btn-icon-notext"> -->
      </div>
      <div data-role="main" class="ui-content">
          <p style = "width: 50%; margin: 0 auto;">This is an app for roommates.</p>
      </div>
      <div data-role="controlgroup" style = "width: 55%; margin: 0 auto">
        <p>ROOM STATUS: {{ status }}</p>
        <p>set by: {{username}}</p>
          <form action="/sign" method="post" action="demoform.asp"> 
            <input type="hidden" name="status" value="Open">
            <input type="hidden" name="roomkey" value="nokeyopen" id="key2">
            <script>
              function setOpenStatus() {
                  console.log("here (open)");
                  document.getElementById("key2").value = localStorage.getItem("userkey");
              }
            </script>
            <a href="javascript:;" class="ui-btn" onclick="setOpenStatus();parentNode.submit();">Open</a>
          </form>
          <form action="/sign" method="post" action="demoform.asp">
            <input type="hidden" name="status" value="Closed">
            <input type="hidden" name="roomkey" value="nokeyclosed" id="key3">
            <script>
              function setClosedStatus() {
                  console.log("here (closed)");
                  document.getElementById("key3").value = localStorage.getItem("userkey");
              }
            </script>
            <a href="javascript:;" class="ui-btn" onclick="setClosedStatus();parentNode.submit();">Closed</a>
          </form>
          <a href="#entercustom" class="ui-btn">Custom...</a>
          <br>
          <a href="#KKhome" class="ui-btn" onclick=location.reload()>Refresh</a>
      </div>

      <div data-role="footer" style = "position:fixed; bottom:0px; right:0px">
        <h1>(C) 2014 EBCM Apps </h1>
      </div>
  </div>

  <!-- for misc errors -->
  <div data-role = "page" data-theme = "a" data-dialog = "true" id= "error">
      <div data-role = "main" class = "ui-content">
          <div class="ui-field-contain">
            <p>This room doesn't exist :(</p>
          </div>
      </div>
  </div>

  <!-- the popup for entering custom messages -->
  <div data-role = "page" data-theme = "a" data-dialog = "true" id= "entercustom">
      <div data-role = "main" class = "ui-content">
          <div class="ui-field-contain">
            <p>New Custom Status</p>
            <form action="/sign" method="post" action="demoform.asp">
                <input type="text" name="status" id="status">
                <input type="hidden" name="roomkey" value="key" id="key4">
                <a href="javascript:;" onclick="setCustomKey();parentNode.submit();" type="status" class="ui-btn">Set status message</a>
                <script>
                  function setCustomKey(){document.getElementById("key4").value = localStorage.getItem("userkey")}
                </script>
            </form>
      </div>
  </div>

</body>

</html>
